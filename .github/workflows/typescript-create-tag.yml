name: 'ðŸ“¦ Create tag reading package.json'

on: 
  workflow_call:

permissions:
  contents: write


jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout to develop
        uses: actions/checkout@v3
        with:
          ref: develop
      - name: Find last tag
        run: echo result=$(git for-each-ref --sort=-creatordate --format '%(refname:short)' --count=1 refs/tags) >> $GITHUB_OUTPUT
      - name: Checkout to main
        uses: actions/checkout@v3
      - name: Pull version from package.json
        id: read-package
        run: |
          echo version=$(jq .version package.json) >> $GITHUB_OUTPUT
          echo line=$(cat package.json | grep '"version":.*,') >> $GITHUB_OUTPUT
        shell: bash
      - name: Release
        uses: softprops/action-gh-release@v1
        with:
          generate_release_notes: true
          name: "v${{ steps.read-package.outputs.version }}"
          tag_name: "v${{ steps.read-package.outputs.version }}"
          target_commitish: main